<div class="row">
	<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
		<div id="ilInteractiveVideoPlayerContainer">
			<video controls="controls" id="ilInteractiveVideo">
				<source type="{VIDEO_TYPE}" src="{VIDEO_SRC}"/>
			</video>
		</div>
		<div id="ilInteractiveVideoCommentsForm">
			<form class="form-horizontal preventDoubleSubmission" method="post" action="{FORM_ACTION}" role="form">
				<div id="il_prop_cont_comment_text" class="form-group">
					<label class="col-sm-3 control-label" for="comment_text">{TXT_COMMENT}</label>
					<div class="col-sm-9">
						<textarea id="comment_text" class="form-control noRTEditor" rows="" wrap="virtual" name="comment_text"></textarea>
						<input type="hidden" name="comment_time" id="comment_time" value="">
					</div>
				</div>
				<div class="ilFormFooter clearfix">
					<div class="col-sm-6 ilFormRequired"></div>
					<div class="col-sm-6 ilFormCmds">
						<input id="ilInteractiveVideoCommentSubmit" class="btn btn-default btn-sm" type="submit" value="{TXT_POST}">
						<button id="ilInteractiveVideoCommentCancel" class="btn btn-default btn-sm" type="button" value="">{TXT_CANCEL}</button>
					</div>
				</div>
			</form>

		</div>
	</div>

	<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
		<div id="ilInteractiveVideoComments" class="scroll-text">
			<ul id="ul_scroll">
			</ul>
		</div>
	</div>
	
	<script type="text/javascript">
		var question_get_url 	= "{QUESTION_GET_URL}";
		var question_post_url 	= "{QUESTION_POST_URL}";
		(function ($) {
			$.fn.scrollToBottom = function (that)
			{
				that.animate({ scrollTop: that.prop('scrollHeight') }, 200);
			};
			
			$("#ilInteractiveVideoCommentSubmit").on("click", function(e) {
				$('#comment_time').val($("video#ilInteractiveVideo")[0].currentTime);
			});

			$("#ilInteractiveVideoCommentCancel").on("click", function(e) {
				$('#comment_text').val("");
			});

			il.Util.addOnLoad(function () {
				var _lastTime = 0,
					comments = {COMMENTS},
					stopPoints = {STOP_POINTS},
					interval = null,
						last_stopPoint = 0;

				var player = new MediaElementPlayer("#ilInteractiveVideo", {
					timerRate: 50,
					enablePluginDebug: false,
					success:           function(media) {

						media.addEventListener('seeked', function(e) {
							console.log("seeked");
							clearInterval(interval);
							if (_lastTime > media.currentTime) {
								_lastTime = media.currentTime;
							} else if (_lastTime < media.currentTime) {
								_lastTime = media.currentTime;
							}
						}, false);

						media.addEventListener('pause', function(e) {
							console.log("paused");
							clearInterval(interval);
							_lastTime = media.currentTime;
						}, false);

						media.addEventListener('playing', function(e) {
							console.log("playing");
							interval = setInterval(function () {
								if (media.currentTime >= media.duration) {
									clearInterval(interval);
									return;
								}
								
								if (!isNaN(media.currentTime) && media.currentTime > 0) {
									// @todo: Evtl. use a better way to detect the relevant stopping point
								
									for (var j = stopPoints.length - 1; j >= 0; j--) {
										var cueTime = stopPoints[j];
										
										if (cueTime >= _lastTime && cueTime <= media.currentTime) {
											var stop_video = 0;
											if (last_stopPoint < cueTime) {
												for (var i = 0; i < Object.keys(comments).length; i++) {
													if (comments[i].comment_time == cueTime) {
														$("#ul_scroll").append('<li> <time id="time">'+ mejs.Utility.secondsToTimeCode(media.currentTime) +' </time> ' + comments[i].comment_text + '</li>');
														jQuery().scrollToBottom($("#ilInteractiveVideoComments"));
														if (comments[i].is_interactive == 1) {
//														console.log('stop true');
															stop_video = 1;
															$().getQuestionPerAjax(comments[i].comment_id);
														}
													}
												}
												if (stop_video == 1) {
													player.pause();
													stop_video = 0;
												}
											}
											last_stopPoint = cueTime;
										} 
									}
									_lastTime = media.currentTime;
								}
							}, 500);

						}, false);
					}
				});
			});
		})(jQuery);
	</script>
</div>
</div>
{MODAL_OVERLAY}